<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title></title>
<script type='text/javascript' src="http://v1-cdn.echoed.com/jquery-1.6.2.min.js"></script>
<script type='text/javascript' src="http://v1-cdn.echoed.com/jquery-ui-1.8.16.custom.min.js"></script>
<script type='text/javascript' src="http://v1-cdn.echoed.com/json2.js"></script>
<script type='text/javascript' src="http://v1-cdn.echoed.com/underscore-min.js"></script>
<script type='text/javascript' src="http://v1-cdn.echoed.com/backbone.js"></script>
<script type='text/javascript' src='http://v1-cdn.echoed.com/highcharts.js'></script>
<script>


if (!('Echoed' in this)) this.Echoed = {};

$(document).ready(function() {
    Echoed.init();
});

var EventAggregator = _.extend({}, Backbone.Events);
//Event Aggregator

Echoed = {
    Views: {
        Pages:{},
        Components:{}
    },
    Models:{},
    init: function() {
        var pageModel = new Echoed.Models.Page();
        var router = new Echoed.Router({EvAg: EventAggregator});
        var subNav = new Echoed.Views.Components.SubNav({EvAg: EventAggregator});
        var nav = new Echoed.Views.Components.Nav({EvAg: EventAggregator});
        var title = new Echoed.Views.Components.Title({EvAg: EventAggregator, page: pageModel});
        router.bind('all', function(route) {
        });

        Backbone.history.start();
    }
};

Echoed.Models.Page = Backbone.Model.extend({
    defaults:{
        title: 'Summary',
        currentNav: 'summary_nav'
    },
    initialize: function(){
    }
});

Echoed.Router = Backbone.Router.extend({
    initialize: function(options) {
        _.bindAll(this, 'summary', 'rewards', 'settings', 'reports');
        this.EvAg = options.EvAg;
    },
    routes:{
        "summary": "summary",
        "": "summary",
        "rewards": "rewards",
        "settings": "settings",
        "reports": "reports",
        "reports/:report" : "reports",
        "reports/:report/:id" : "reports"
    },
    summary: function() {
        var pageView = new Echoed.Views.Pages.Summary({EvAg: this.EvAg});
    },
    rewards: function() {
        var pageView = new Echoed.Views.Pages.Rewards({EvAg: this.EvAg});
    },
    settings: function() {
        var pageView = new Echoed.Views.Pages.Settings({EvAg: this.EvAg});
    },
    reports: function(report, id) {
        var pageView = new Echoed.Views.Pages.Reports({EvAg: this.EvAg,report: report});
    }

});

Echoed.Views.Pages.Reports = Backbone.View.extend({
    el: '#content',
    initialize: function(options) {
        _.bindAll(this, 'render');
        this.EvAg = options.EvAg;
        this.report = options.report;

        this.render();
    },
    render: function() {
        switch (this.report) {
            case "customers":
                var template = _.template($('#template-view-reports-customers').html());
                $(this.el).hide().html(template).fadeIn();
                $('.select-report').combobox();
                this.EvAg.trigger('subnav/select', {subnav: 'Customers'});
                break;
            case "products":
                var template = _.template($('#template-view-reports-products').html());
                $(this.el).hide().html(template).fadeIn();
                var reportChart = new Echoed.Views.Components.Chart({EvAg: this.EvAg, el: '#product-report-chart'});
                this.EvAg.trigger('subnav/select', {subnav: 'Products'});
                break;
            default:
                $(this.el).html('');
                break;
        }
        this.EvAg.trigger('page/change',
                {
                    page: 'reports',
                    subNav: [
                        {
                            href: '#reports/customers',
                            text: 'Customers'
                        },
                        {
                            href: '#reports/products',
                            text: 'Products'
                        }
                    ]
                }
        );
        return this;
    }

});

Echoed.Views.Pages.Settings = Backbone.View.extend({
    el: '#content',
    initialize: function(options) {
        _.bindAll(this);

        this.EvAg = options.EvAg;

        this.render();
    },
    render: function() {
        var template = _.template($('#template-view-settings').html());
        $(this.el).hide().html(template).fadeIn();

        this.EvAg.trigger('page/change',
                {
                    page: 'settings'
                }
        );

        return this;
    }
});

Echoed.Views.Pages.Rewards = Backbone.View.extend({
    el: '#content',
    initialize: function(options) {
        _.bindAll(this);

        this.EvAg = options.EvAg;

        this.render();
    },
    render: function() {
        var template = _.template($('#template-view-rewards').html());
        $(this.el).hide().html(template).fadeIn();

        this.EvAg.trigger('page/change',
                {
                    page: 'rewards'
                }
        );

        return this;
    }
});

Echoed.Views.Pages.Summary = Backbone.View.extend({
    el: '#content',
    initialize: function(options) {

        _.bindAll(this);

        this.EvAg = options.EvAg;

        this.render();
    },
    render: function() {
        var template = _.template($('#template-view-summary').html());
        $(this.el).hide().html(template).fadeIn(function() {
            $('#ss-likes').hide().html(20).fadeIn();
            $('#ss-views').hide().html(20).fadeIn();
            $('#ss-retweets').hide().html(20).fadeIn();
            $('#ss-new-echoes').hide().html(20).fadeIn();
            $('#ss-open-echoes').hide().html(20).fadeIn();
            $('#ss-comments').hide().html(20).fadeIn();
            chart = new Echoed.Views.Components.Chart({EvAg: this.EvAg, el: '#chart'});
        });


        this.EvAg.trigger('page/change', {page: 'summary'});

        return this;
    }
});

Echoed.Views.Components.Title = Backbone.View.extend({
    el: 'title',
    initialize: function(options){
        _.bindAll(this);
        this.EvAg = options.EvAg;
        this.render(options.page);
    },
    render: function(page){
        $(this.el).html(page.get("title"));
    }
});


Echoed.Views.Components.ProductSelector = Backbone.View.extend({
    initialize: function() {
    }
});

Echoed.Views.Components.ProductSummary = Backbone.View.extend({
    initialize: function(options) {
        _.bindAll(this);
        this.EvAg = options.EvAg;
        this.render();
    },
    render: function() {
        var template = _.template($('#template-view-component-productsummary').html());
        $(this.el).hide().html(template).fadeIn(function() {
            alert($('#select-report').html());
        });
    }
});

Echoed.Views.Components.ProductCharting = Backbone.View.extend({
    initialize: function(options) {
        _.bindAll(this);
        this.EvAg = options.EvAg;
        this.render();
    }

});

Echoed.Views.Components.RewardTable = Backbone.View.extend({
    initialize: function(options) {
        _.bindAll(this);
        this.EvAg = options.EvAg;
        this.render();
    },
    render: function() {
        var template = _.template($("#template-view-component-rewardtable").html());
        $(this.el).html(template);
        return this;
    }
});

Echoed.Views.Components.Nav = Backbone.View.extend({
    el: '#header-nav',
    initialize: function(options) {
        _.bindAll(this, 'pageChange');

        this.EvAg = options.EvAg;
        this.EvAg.bind('page/change', this.pageChange);
        this.currentPage = null;
    },
    render: function() {
    },
    pageChange: function(options) {
        if (this.currentPage != options.page) {
            if (this.currentPage)
                $('#' + this.currentPage + "_nav").removeClass("current");
            $('#' + options.page + "_nav").addClass("current");
            this.currentPage = options.page;
        }
    }
});

Echoed.Views.Components.SubNav = Backbone.View.extend({
    el: '#sub-nav',
    initialize: function(options) {

        _.bindAll(this, 'pageChange', 'slideDown', 'slideUp', 'select');

        this.EvAg = options.EvAg;
        this.EvAg.bind('page/change', this.pageChange);
        this.EvAg.bind('subnav/select', this.select);
        this.render();
    },
    render: function() {
        return this;
    },
    select: function(options) {
        $("subnav-" + options.subnav).addClass("current");
    },
    pageChange: function(options) {
        var element = $(this.el);
        element.html('');
        if (options.subNav) {
            $(options.subNav).each(function(index, item) {
                $('<a></a>').hide().attr("id", "subnav-" + item.text).attr('href', item.href).html(item.text).appendTo(element).fadeIn();
            });
            this.slideDown();
        }
        else {
            this.slideUp();
        }
    },
    slideDown: function() {
        $(this.el).slideDown('fast');
    },
    slideUp: function() {
        $(this.el).slideUp('fast');
    }
});

Echoed.Views.Components.Map = Backbone.View.extend({
    el: '#map',
    initialize: function(options) {
        _.bindAll(this);
        this.EvAg = options.EvAg;
        this.chart = null;
        var container = $(this.el);
    },
    render: function() {
    }
});

Echoed.Views.Components.Chart = Backbone.View.extend({
    initialize: function(options) {
        _.bindAll(this);
        this.EvAg = options.EvAg;
        this.chart = null;
        this.el = options.el;
        this.render();
    },
    render: function() {
        var chartOptions = {
            chart: {
                renderTo: this.el.substr(1),
                defaultSeriesType: 'column'
            },
            credits: {
                text: '',
                href: ''
            },
            colors: ['#3B5998','#09F'],
            title: { text: ''},
            yAxis:{
                title:{ text: 'Page Views'}
            },
            xAxis: {
                categories: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],
            },
            tooltip: {
                formatter: function() {
                    return '<b>' + this.x + '</b><br/>' +
                            this.series.name + ': ' + this.y + '<br/>' +
                            'Total: ' + this.point.stackTotal;
                }
            },
            series: [
                {
                    name: 'Facebook',
                    data: [5, 3, 4, 7, 2],
                },
                {
                    name: 'Twitter',
                    data: [2, 2, 3, 2, 1]
                }
            ]
        };
        this.chart = new Highcharts.Chart(chartOptions);
    }
});
</script>

<script type="text/template" id="template-view-summary">
    <div class="row">
        <div id="summary-stats" class="full">
            <div id="summary-stats-column1"></div>
            <div id="summary-stats-column2">
                <div id="ss-upper_row" class="ss-row">
                    <div class="ss-box">
                        <div class="ss-box-label">
                            Open Echoes
                        </div>
                        <div id="ss-open-echoes" class="ss-box-number echoed-text">
                        </div>
                    </div>
                    <div class="ss-box">
                        <div class="ss-box-label">
                            New Echoes
                        </div>
                        <div id="ss-new-echoes" class="ss-box-number echoed-text">
                        </div>
                    </div>
                    <div class="ss-box">
                        <div class="ss-box-label">
                            Page Views
                        </div>
                        <div id="ss-views" class="ss-box-number echoed-text">
                        </div>
                    </div>
                </div>
                <div id="ss-lower_row" class="ss-row">
                    <div class="ss-box">
                        <div class="ss-box-label">
                            Comments
                        </div>
                        <div id="ss-comments" class="ss-box-number fb-text">
                        </div>
                    </div>
                    <div class="ss-box">
                        <div class="ss-box-label">
                            Likes
                        </div>
                        <div id="ss-likes" class="ss-box-number fb-text">
                        </div>
                    </div>
                    <div class="ss-box">
                        <div class="ss-box-label">
                            Retweets
                        </div>
                        <div id="ss-retweets" class="ss-box-number twitter-text">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div id="chart-container" class="half">
            <div class="label">Social Activity</div>
            <div id="chart" class="half-chart">
            </div>
        </div>
        <div id="map" class="half">
        </div>
    </div>
    <div class="row">
        <div id="chart-container2" class="third"></div>
        <div id="chart-container3" class="third"></div>
        <div id="chart-container4" class="third"></div>
    </div>
</script>


<script type="text/template" id="template-view-settings">
    <div class="row">
        <div id="settings-container" class="full">

        </div>
    </div>
</script>

<link rel="stylesheet" type="text/css" href="echoed.css"/>
</head>
<body class="retailer">
<div id="container">
    <div id="header">
        <div id="logo">
            Echoed
        </div>
        <div id="user">
            {#EchoedUser}{firstName}{lastName}{/EchoedUser}<br/>
            Rewards: {}
        </div>
        <div id="header-nav">
            <ul>
                <li id="summary_nav">
                    <a href="#summary">
                        Summary
                    </a>
                </li>
                <li id="rewards_nav">
                    <a href="#rewards">
                        Reward Manager
                    </a>
                </li>
                <li id="reports_nav">
                    <a href="#reports">
                        Reports
                    </a>
                </li>
                <li id="settings_nav">
                    <a href="#settings">
                        Settings
                    </a>
                </li>
                <li id="logout_nav">
                    <a href="logout">
                        Logout
                    </a>
                </li>
                <div class="clear"></div>
            </ul>
        </div>
    </div>
    <div id="sub-nav" style="display:none"></div>
    <div id="content">
    </div>
</div>
</body>
</html>

<script type="text/template" id="template-view-rewards">
    <div class="row">
        <div id="reward-table-container" class="full">
        </div>
    </div>
</script>

<script type="text/template" id="template-view-reports-products">
    <div class="row">
        <div class="full">
            <div id="product-selector" class="report-selector">
                <select id="select-report" class="select-report">
                    <option value="Shirt">Shirt</option>
                </select>
            </div>
            <div id="report-summary">
                <div id="summary-stats-column1">
                    <div>
                        <div class="product-detail-image-container">
                            <img src="pic5.jpg" class="product-detail-image"/>
                        </div>
                        <div class="product-detail-table-container">
                            <table class="product-detail-table" cellspacing="0">
                                <tr>
                                    <td width="100px">ID Number</td>
                                    <td>246301</td>
                                </tr>
                                <tr>
                                    <td>Brand</td>
                                    <td>Redhawk Brigade</td>
                                </tr>
                                <tr>
                                    <td>Type</td>
                                    <td>Shirt</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="ss-row">
                        <div class="ss-box">
                            <div class="ss-box-label">
                                Views
                            </div>
                            <div class="ss-box-number echoed-text">
                                20
                            </div>
                        </div>
                        <div class="ss-box">
                            <div class="ss-box-label">
                                Likes
                            </div>
                            <div class="ss-box-number fb-text">
                                30
                            </div>
                        </div>
                        <div class="ss-box">
                            <div class="ss-box-label">
                                Retweets
                            </div>
                            <div class="ss-box-number twitter-text">
                                10
                            </div>
                        </div>
                    </div>
                    <div class="ss-row">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="full">
            <div class="report-nav">
                <div class="label">DYNAMIC REPORTING</div>
                <div class="report-options">
                </div>
            </div>
            <div id="product-report-chart" class="report-chart">
            </div>
        </div>
    </div>
</script>


<script type="text/template" id="template-view-reports-customers">
    <div class="row">
        <div class="full">
            <div id="customer-selector" class="report-selector">
                <select class="select-report">
                    <option value="">Evan W.</option>
                </select>
            </div>
            <div id="report-summary-customer">
                <div id="summary-stats-column1">
                </div>
                <div id="summary-stats-column2">
                    <div id="ss-upper_row" class="ss-row">
                        <div class="ss-box">
                            <div class="ss-box-label">
                                Views
                            </div>
                            <div id="ss-views" class="ss-box-number echoed-text">

                            </div>
                        </div>
                        <div class="ss-box">
                            <div class="ss-box-label">
                                Likes
                            </div>
                            <div id="ss-likes" class="ss-box-number fb-text">
                            </div>
                        </div>
                        <div class="ss-box">
                            <div class="ss-box-label">
                                Retweets
                            </div>
                            <div id="ss-retweets" class="ss-box-number twitter-text">
                            </div>
                        </div>
                    </div>
                    <div id="ss-lower_row" class="ss-row">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="full">
            <div class="report-nav">
                <div class="label">DYNAMIC REPORTING</div>
                <div class="report-options">
                </div>
            </div>
            <div class="report-chart">
            </div>
        </div>
    </div>
</script>

<script type="text/template" id="template-view-reports-customers-summary">
</script>

<script type="text/javascript">
    Highcharts.theme = {
        yAxis: {
            min: 0,
            title: {
                style:{
                    color: '#000000'
                }
            },
            labels:{
                enabled: false
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    fontFamily:'BebasNeue',
                    fontSize: 24,
                    color: '#FF7733'
                }
            },
            gridLineWidth:0,
            lineWidth: 1,
            lineColor: '#000'

        },
        xAxis: {
            lineColor: '#000',
                labels:{
                    style:{
                        color: '#000000'
                    }
                }
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: false,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'black',
                    style:{
                        fontFamily: 'Arial',
                        fontWeight: 'bold',
                        fontSize: 14
                    }
                }
            },
            series:{
                pointWidth: 70,
                pointPadding: 0,
                groupPadding:0,
                borderWidth: 1,
                borderColor: "#666",
                shadow: false
            }
        },
        legend: {
            align: 'center',
            verticalAlign: 'bottom',
            y: 15,
            backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColorSolid) || 'white',
            borderColor: '#CCC',
            borderWidth: 0,
            shadow: false
        }
    };

    var highchartsOptions  = Highcharts.setOptions(Highcharts.theme);

</script>

