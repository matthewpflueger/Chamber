<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Story Name</title>
    <link rel="stylesheet" type="text/css" href="{{urls.css}}/echoed-story.css" />
</head>
<body>

</body>
    <script type='text/javascript'>
        var EchoedData = {
            "items" : [
                {
                    "title" : "Chewy Vuitton Designer Handbag",
                    "author": "Evan",
                    "segments": [
                        {
                            "title": "Why I Bought It",
                            "text": "This is for our beautiful dog Stella. Forget about all the bones and other stuff she tears right through, we're going high class with a Chewy Vuitton. Only the best in French fashion for our little Frenchie!",
                            "contents": [
                                {
                                    "type" : "image",
                                    "url" : "http://farm8.staticflickr.com/7087/7269959254_e50387b579_z.jpg"
                                },
                                {
                                    "type" : "image",
                                    "url" : "http://cache.krop.com/dimitri-4fa243a51099382.jpg"
                                },
                                {
                                    "type" : "image",
                                    "url" : "http://cache.krop.com/dimitri-4fa243a51099382.jpg"
                                }

                            ]
                        },
                        {
                            "title": "WHY I LOVE IT",
                            "text" : "This is for our beautiful dog Stella. Forget about all the bones and other stuff she tears right through, we're going high class with a Chewy Vuitton. Only the best in French fashion for our little Frenchie!",
                            "contents": [
                                {
                                }
                            ]
                        }
                    ],
                    "nav": [
                        {
                            "subtitle": "Test",
                            "img": "http://farm8.staticflickr.com/7087/7269959254_e50387b579_z.jpg"
                        },
                        {
                            "subtitle": "Test",
                            "img": "http://farm8.staticflickr.com/7087/7269959254_e50387b579_z.jpg"
                        }
                    ]
                }
            ]
        };
    </script>
    <script type='text/javascript'>

        /**
         * Vanilla Masonry v1.0.04
         * Dynamic layouts for the flip-side of CSS Floats
         * http://vanilla-masonry.desandro.com
         *
         * Licensed under the MIT license.
         * Copyright 2012 David DeSandro
         */
        (function(a,b){function e(a){return new RegExp("(^|\\s+)"+a+"(\\s+|$)")}function n(a,b,c){if(c.indexOf("%")===-1)return c;var d=a.style,e=d.width,f;return d.width=c,f=b.width,d.width=e,f}function o(a,b,c){var d=b!=="height",e=d?a.offsetWidth:a.offsetHeight,f=d?"Left":"Top",g=d?"Right":"Bottom",h=j(a),i=parseFloat(h["padding"+f])||0,k=parseFloat(h["padding"+g])||0,l=parseFloat(h["border"+f+"Width"])||0,o=parseFloat(h["border"+g+"Width"])||0,p=h["margin"+f],q=h["margin"+g],r,s;m||(p=n(a,h,p),q=n(a,h,q)),r=parseFloat(p)||0,s=parseFloat(q)||0;if(e>0)c?e+=r+s:e-=i+k+l+o;else{e=h[b];if(e<0||e==null)e=a.style[b]||0;e=parseFloat(e)||0,c&&(e+=i+k+r+s+l+o)}return e}function p(b,c,d){b.addEventListener?b.addEventListener(c,d,!1):b.attachEvent&&(b["e"+c+d]=d,b[c+d]=function(){b["e"+c+d](a.event)},b.attachEvent("on"+c,b[c+d]))}function q(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&(a.detachEvent("on"+b,a[b+c]),a[b+c]=null,a["e"+b+c]=null)}function r(a,b){if(!a)return;this.element=a,this.options={};for(var c in r.defaults)this.options[c]=r.defaults[c];for(c in b)this.options[c]=b[c];this._create(),this.build()}var c=a.document,d="classList"in c.createElement("div"),f=d?function(a,b){return a.classList.contains(b)}:function(a,b){return e(b).test(a.className)},g=d?function(a,b){a.classList.add(b)}:function(a,b){f(a,b)||(a.className=a.className+" "+b)},h=d?function(a,b){a.classList.remove(b)}:function(a,b){a.className=a.className.replace(e(b)," ")},i=c.defaultView,j=i&&i.getComputedStyle?function(a){return i.getComputedStyle(a,null)}:function(a){return a.currentStyle},k=c.getElementsByTagName("body")[0],l=c.createElement("div");l.style.marginTop="1%",k.appendChild(l);var m=j(l).marginTop!=="1%";k.removeChild(l);var s=["position","height"];r.defaults={isResizable:!0,gutterWidth:0,isRTL:!1,isFitWidth:!1},r.prototype={_getBricks:function(a){var b;for(var c=0,d=a.length;c<d;c++)b=a[c],b.style.position="absolute",g(b,"masonry-brick"),this.bricks.push(b)},_create:function(){this.reloadItems();var b=this.element.style;this._originalStyle={};for(var c=0,d=s.length;c<d;c++){var e=s[c];this._originalStyle[e]=b[e]||""}this.element.style.position="relative",this.horizontalDirection=this.options.isRTL?"right":"left",this.offset={};var f=j(this.element),h=this.options.isRTL?"paddingRight":"paddingLeft";this.offset.y=parseFloat(f.paddingTop)||0,this.offset.x=parseFloat(f[h])||0,this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth=="function";var i=this;setTimeout(function(){g(i.element,"masonry")}),this.options.isResizable&&p(a,"resize",function(){i._handleResize()})},build:function(a){this._getColumns(),this._reLayout(a)},_getColumns:function(){var a=this.options.isFitWidth?this.element.parentNode:this.element,b=o(a,"width");this.columnWidth=this.isFluid?this.options.columnWidth(b):this.options.columnWidth||o(this.bricks[0],"width",!0)||b,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((b+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},reloadItems:function(){this.bricks=[],this._getBricks(this.element.children)},_reLayout:function(a){var b=this.cols;this.colYs=[];while(b--)this.colYs.push(0);this.layout(this.bricks,a)},layout:function(a,b){var c,d,e,f,g,h,i;for(var j=0,k=a.length;j<k;j++){c=a[j];if(c.nodeType!==1)continue;d=Math.ceil(o(c,"width",!0)/this.columnWidth),d=Math.min(d,this.cols);if(d===1)i=this.colYs;else{e=this.cols+1-d,i=[];for(h=0;h<e;h++)g=this.colYs.slice(h,h+d),i[h]=Math.max.apply(Math,g)}var l=Math.min.apply(Math,i);for(var m=0,n=i.length;m<n;m++)if(i[m]===l)break;c.style.top=l+this.offset.y+"px",c.style[this.horizontalDirection]=this.columnWidth*m+this.offset.x+"px";var p=l+o(c,"height",!0),q=this.cols+1-n;for(h=0;h<q;h++)this.colYs[m+h]=p}var r={};this.element.style.height=Math.max.apply(Math,this.colYs)+"px";if(this.options.isFitWidth){var s=0;j=this.cols;while(--j){if(this.colYs[j]!==0)break;s++}this.element.style.width=(this.cols-s)*this.columnWidth-this.options.gutterWidth+"px"}b&&b.call(a)},_handleResize:function(){function b(){a.resize(),a._resizeTimeout=null}var a=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(b,100)},resize:function(){var a=this.cols;this._getColumns(),(this.isFluid||this.cols!==a)&&this._reLayout()},reload:function(a){this.reloadItems(),this.build(a)},appended:function(a,b,c){var d=this,e=function(){d._appended(a,c)};if(b){var f=o(this.element,"height")+"px";for(var g=0,h=a.length;g<h;g++)a[g].style.top=f;setTimeout(e,1)}else e()},_appended:function(a,b){this._getBricks(a),this.layout(a,b)},destroy:function(){var b;for(var c=0,d=this.bricks.length;c<d;c++)b=this.bricks[c],b.style.position="",b.style.top="",b.style.left="",h(b,"masonry-brick");var e=this.element.style;d=s.length;for(c=0;c<d;c++){var f=s[c];e[f]=this._originalStyle[f]}h(this.element,"masonry"),this.resizeHandler&&q(a,"resize",this.resizeHandler)}},r.getWH=o,a.Masonry=r})(window);;

        //GOOGLE WEBFONTS
        WebFontConfig = {
            google: { families: ['Lato:300,400,700,900','Open+Sans+Condensed:300,400,700','Open+Sans:400'] }
        };
        (function(){
            var wf= document.createElement('script');
            wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
                    '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
            wf.type = 'text/javascript';
            wf.async = 'true';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(wf, s);
        })();

        //Echoed
        (function(){

            var Echoed = {};

            start(EchoedData);

            function start(data){
                loadFrame();
                loadData(data);
                loadItem(0);
            }

            function loadData(data){
                Echoed.data = data;
            }

            function loadItem(itemNum){
                Echoed.item = Echoed.data.items[itemNum];
                loadHeader(Echoed.item.title, Echoed.item.author);
                loadSegment(0);
                //loadNav();
                loadComments();
            }

            function loadFrame(){

                Echoed.htmlBody = document.getElementsByTagName('body')[0];
                Echoed.containerNode = document.createElement('div');
                Echoed.containerNode.className = "echo-story-container";

                Echoed.headerNode = document.createElement('div');
                Echoed.headerNode.className = "echo-story-header";

                Echoed.bodyNode = document.createElement('div');
                Echoed.bodyNode.className = "echo-story-body clearfix";

                Echoed.footerNode = document.createElement('div');
                Echoed.footerNode.className = "echo-story-footer clearfix";

                Echoed.containerNode.appendChild(Echoed.headerNode);
                Echoed.containerNode.appendChild(Echoed.bodyNode);
                Echoed.containerNode.appendChild(Echoed.footerNode);

                Echoed.htmlBody.appendChild(Echoed.containerNode);
            }

            function loadHeader(title, author){
                var headerTitle = document.createElement('div');
                headerTitle.className='echo-s-h-title';
                headerTitle.innerHTML = '<span class="echo-s-h-t-t">' + title + '</span> Story by <span class="echo-s-h-t-n">' + author + '</span>';
                Echoed.headerNode.appendChild(headerTitle);
            }

            function loadNav(){
                Echoed.navNode = document.createElement('div');
                Echoed.navNode.className = "echo-story-nav clearfix";
                Echoed.footerNode.appendChild(Echoed.navNode);

                for(i in Echoed.item.nav){
                    var navIconNode = document.createElement('div');
                    navIconNode.className = "echo-s-n-s";
                    navIconNode.setAttribute("segmentId", i);
                    navIconNode.setAttribute("title", Echoed.item.segments[i].title);

                    var navImage = document.createElement('img');
                    navImage.src = Echoed.item.nav[i].img;
                    navIconNode.appendChild(navImage);

                    var toolTipNode = document.createElement('div');
                    toolTipNode.className = "echo-s-n-s-tt";
                    toolTipNode.innerHTML = Echoed.item.segments[i].title;
                    navIconNode.appendChild(toolTipNode);

                    navIconNode.addEventListener('click', function(e){
                        loadSegment(this.getAttribute("segmentId"));
                        hideToolTip(this);
                    });

                    navIconNode.addEventListener('mouseover', function(e){
                        showToolTip(this);
                    });

                    navIconNode.addEventListener('mouseout', function(e){
                        hideToolTip(this);
                    });
                    Echoed.navNode.appendChild(navIconNode);
                }
            }

            function showToolTip(e){
                var tt = e.getElementsByClassName("echo-s-n-s-tt")[0];
                var h = tt.clientHeight;
                var w = tt.clientWidth;
                var offsetTop = e.offsetTop - (h + 10) ;
                var offsetLeft = e.offsetLeft + (e.clientWidth / 2 ) - (w / 2);
                tt.style.top = offsetTop.toString() + "px";
                tt.style.left = offsetLeft.toString() + "px";
                tt.style.visibility = "visible";
            }

            function hideToolTip(e){
                var tt = e.getElementsByClassName("echo-s-n-s-tt")[0];
                tt.style.visibility = "hidden";
            }

            function loadComments(){
                Echoed.commentsNode = document.createElement('div');
                Echoed.commentsNode.className = "echo-story-comments";
                Echoed.commentsNode.innerHTML = '<div class="echo-s-c-t">Comments:</div>';
                Echoed.footerNode.appendChild(Echoed.commentsNode);
            }

            function masonry(){
                if(typeof(Echoed.masonry) != "undefined") {
                    Echoed.masonry.destroy();
                    Echoed.masonry = new Masonry(Echoed.galleryNode);
                }
                window.onload = function(){
                    Echoed.masonry = new Masonry(Echoed.galleryNode);
                }
            }

            function loadTitles(){

            }

            function loadSegment(segmentNumber){
                var segment = Echoed.item.segments[segmentNumber];
                Echoed.bodyNode.innerHTML = '';
                var textNode = document.createElement('div');
                textNode.className = "echo-s-b-text";
                var textTitleNode = document.createElement('div');
                textTitleNode.className = "echo-s-b-t-t";
                textTitleNode.innerHTML = segment.title;
                textNode.appendChild(textTitleNode);
                var textBodyNode = document.createElement('div');
                textBodyNode.className = "echo-s-b-t-b";
                textBodyNode.innerHTML = segment.text;
                textNode.appendChild(textBodyNode);

                Echoed.galleryNode = document.createElement('div');
                Echoed.galleryNode.className = "echo-s-b-gallery";
                Echoed.bodyNode.appendChild(textNode);
                Echoed.bodyNode.appendChild(Echoed.galleryNode);
                for (i in segment.contents){
                    var content = segment.contents[i];
                    var itemNode = document.createElement('div');
                    itemNode.className = "echo-s-b-item";
                    var icNode = document.createElement('div');
                    icNode.className = "echo-s-b-i-c";
                    itemNode.appendChild(icNode);

                    switch(content.type){
                        case "image":
                            var img = document.createElement('img');
                            img.src = content.url;
                            icNode.appendChild(img);
                            break;
                    }
                    Echoed.galleryNode.appendChild(itemNode);
                    //masonry();
                }
            }
        })()
    </script>
</html>