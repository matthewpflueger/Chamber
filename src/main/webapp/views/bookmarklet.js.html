(function(){

    var i=0, path;
    var links = document.getElementsByTagName('link');
    var url = window.location;
    var title = document.getElementsByTagName('title')[0].innerHTML;
    for(i = 0; i < links.length; i++){
        if(links[i].getAttribute('rel') === 'canonical'){
            url = links[i].getAttribute('href');
        }
    }

    var a =     document.createElement('a');
    a.href =    url;
    domain =    a.hostname;
    path =      encodeURIComponent(a.pathname.split("#")[0]);
    title  =    encodeURIComponent(title);

    var es = document.createElement('script'); es.type = 'text/javascript'; es.async = true;
    var html = "{{https.site}}/app/js?pid=" + domain + "&path=" + path + "&title=" + title;
    es.src = html;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(es, s);

})();