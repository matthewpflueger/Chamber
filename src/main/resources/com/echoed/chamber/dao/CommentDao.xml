<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.echoed.chamber.dao.CommentDao">

    <resultMap id="commentResult" type="com.echoed.chamber.domain.Comment">
        <constructor>
            <idArg column="commentId" javaType="String" />
            <arg column="commentUpdatedOn" javaType="_long" />
			<arg column="commentCreatedOn" javaType="_long" />
			<arg column="commentStoryId" javaType="String" />
            <arg column="commentEchoedUserId" javaType="String" />
            <arg column="commentPartnerId" javaType="String" />
            <arg column="commentPartnerSettingsId" javaType="String" />
            <arg column="commentEchoId" javaType="String" />
            <arg column="commentChapterId" javaType="String" />
            <arg column="commentByEchoedUserId" javaType="String" />
            <arg column="commentParentCommentId" javaType="String" />
            <arg column="commentText" javaType="String" />
        </constructor>
    </resultMap>


    <sql id="commentColumns">
        CMT.id as commentId,
        CMT.updatedOn as commentUpdatedOn,
        CMT.createdOn as commentCreatedOn,
        CMT.storyId as commentStoryId,
        CMT.echoedUserId as commentEchoedUserId,
        CMT.partnerId as commentPartnerId,
        CMT.partnerSettingsId as commentPartnerSettingsId,
        CMT.echoId as commentEchoId,
        CMT.chapterId as commentChapterId,
        CMT.byEchoedUserId as commentByEchoedUserId,
        CMT.parentCommentId as commentParentCommentId,
        CMT.text as commentText
    </sql>

    <insert id="insert" parameterType="com.echoed.chamber.domain.Comment">
        insert into Comment(
            id,
            updatedOn,
            createdOn,
            storyId,
            echoedUserId,
            partnerId,
            partnerSettingsId,
            echoId,
            chapterId,
            byEchoedUserId,
            parentCommentId,
            text
        ) values (
            #{id},
            #{createdOn},
            #{updatedOn},
            #{storyId},
            #{echoedUserId},
            #{partnerId},
            #{partnerSettingsId},
            #{echoId},
            #{chapterId},
            #{byEchoedUserId},
            #{parentCommentId},
            #{text})
    </insert>

    <select id="findByStoryId" resultMap="commentResult">
        select <include refid="commentColumns" />
        from Comment CMT
        where CMT.storyId = #{storyId}
    </select>

    <select id="findByIdAndChapterId" resultMap="commentResult">
        select <include refid="commentColumns" />
        from Comment CMT
        where CMT.id = #{id} and CMT.chapterId = #{chapterId}
    </select>

    <delete id="deleteById">
        delete from Comment where id = #{id}
    </delete>

</mapper>

