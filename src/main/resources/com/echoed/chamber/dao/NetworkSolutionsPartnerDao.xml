<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.echoed.chamber.dao.NetworkSolutionsPartnerDao">

    <resultMap id="networkSolutionsPartnerResult" type="com.echoed.chamber.domain.NetworkSolutionsPartner">
        <constructor>
            <idArg column="id" javaType="String" />
            <arg column="updatedOn" javaType="Date" />
            <arg column="createdOn" javaType="Date" />
            <arg column="name" javaType="String" />
            <arg column="email" javaType="String" />
            <arg column="phone" javaType="String"/>
            <arg column="userKey" javaType="String" />
            <arg column="userToken" javaType="String" />
            <arg column="userTokenExpiresOn" javaType="Date" />
            <arg column="storeUrl" javaType="String" />
            <arg column="secureStoreUrl" javaType="String" />
            <arg column="companyName" javaType="String" />
            <arg column="partnerId" javaType="String" />
        </constructor>
    </resultMap>

    <select id="findByPartnerId" resultMap="networkSolutionsPartnerResult">
        select * from NetworkSolutionsPartner where partnerId=#{partnerId}
    </select>
    
    <select id="findByUserKey" resultMap="networkSolutionsPartnerResult">
        select * from NetworkSolutionsPartner where userKey=#{userKey} and partnerId is null
    </select>

    <select id="findByDomain" resultMap="networkSolutionsPartnerResult">
        select * from NetworkSolutionsPartner where storeUrl=#{domain}
    </select>

    <select id="findByEmail" resultMap="networkSolutionsPartnerResult">
        select * from NetworkSolutionsPartner where email=#{email}
    </select>

    <insert id="insert" parameterType="com.echoed.chamber.domain.NetworkSolutionsPartner">
    	insert into NetworkSolutionsPartner(
    			id,
    			updatedOn,
    			createdOn,
    			name,
    			email,
    			phone,
    			userKey,
    			userTokenExpiresOn)
    		values (
    			#{id},
    			#{updatedOn},
    			#{createdOn},
    			#{name},
    			#{email},
    			#{phone},
    			#{userKey},
    			date('2038-01-01'))
    </insert>

    <update id="update" parameterType="com.echoed.chamber.domain.NetworkSolutionsPartner">
        update NetworkSolutionsPartner set
            userToken = #{userToken},
            userTokenExpiresOn = #{userTokenExpiresOn},
            storeUrl = #{storeUrl},
            secureStoreUrl = #{secureStoreUrl},
            companyName = #{companyName},
            partnerId = #{partnerId}
        where id = #{id}
    </update>
</mapper>

