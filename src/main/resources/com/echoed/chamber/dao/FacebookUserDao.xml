<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.echoed.chamber.dao.FacebookUserDao">

    <cache-ref namespace="com.echoed.chamber.dao.cache.Default" />

    <resultMap id="facebookUserResult" type="com.echoed.chamber.domain.FacebookUser">
        <constructor>
            <idArg column="id" javaType="String" />
            <arg column="updatedOn" javaType="Date" />
			<arg column="createdOn" javaType="Date" />
            <arg column="echoedUserId" javaType="String" />
            <arg column="facebookId" javaType="String" />
            <arg column="name" javaType="String" />
            <arg column="email" javaType="String" />
			<arg column="link" javaType="String" />
			<arg column="gender" javaType="String" />
			<arg column="timezone" javaType="String" />
			<arg column="locale" javaType="String" />
			<arg column="accessToken" javaType="String" />
        </constructor>
    </resultMap>


    <select id="findByFacebookId" resultMap = "facebookUserResult">
        select * from FacebookUser where facebookId = #{facebookId}
    </select>

    <select id="findById" resultMap="facebookUserResult">
    	select * from FacebookUser where id = #{id}
    </select>

    <select id="findByEmail" resultMap="facebookUserResult">
    	select * from FacebookUser where email = #{email}
    </select>

    <insert id="insertOrUpdate" parameterType="com.echoed.chamber.domain.FacebookUser">
    	insert into FacebookUser(
    			id,
    			createdOn,
    			echoedUserId,
    			facebookId,
    			name,
    			email,
    			link,
    			timezone,
    			locale,
    			gender,
    			accessToken)
    		values (
    			#{id},
    			#{createdOn},
    			#{echoedUserId},
    			#{facebookId},
    			#{name},
    			#{email},
    			#{link},
    			#{timezone},
    			#{locale},
    			#{gender},
    			#{accessToken})
    		on duplicate key update
    		    name=#{name},
                email=#{email},
                link=#{link},
                timezone=#{timezone},
                locale=#{locale},
                gender=#{gender},
    		    accessToken = #{accessToken}
    </insert>

    <update id="updateAccessToken" parameterType="com.echoed.chamber.domain.FacebookUser">
        update FacebookUser set
            accessToken=#{accessToken}
        where
            id=#{id}
    </update>

    <update id="updateEchoedUser" parameterType="com.echoed.chamber.domain.FacebookUser">
        update FacebookUser set
            echoedUserId=#{echoedUserId}
        where
            id=#{id}
    </update>

    <delete id="deleteByEmail">
        delete from FacebookUser where email = #{email}
    </delete>


</mapper>
