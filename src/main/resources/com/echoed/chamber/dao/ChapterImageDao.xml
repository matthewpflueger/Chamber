<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.echoed.chamber.dao.ChapterImageDao">


    <resultMap id="chapterImageResult" type="com.echoed.chamber.domain.ChapterImage">
        <constructor>
            <idArg column="chapterImageId" javaType="String" />
            <arg column="chapterImageUpdatedOn" javaType="_long" />
			<arg column="chapterImageCreatedOn" javaType="_long" />
			<arg column="chapterImageStoryId" javaType="String" />
            <arg column="chapterImageEchoedUserId" javaType="String" />
            <arg column="chapterImagePartnerId" javaType="String" />
            <arg column="chapterImagePartnerHandle" javaType="String" />
            <arg column="chapterImagePartnerSettingsId" javaType="String" />
            <arg column="chapterImageEchoId" javaType="String" />
            <arg column="chapterImageChapterId" javaType="String" />
            <arg resultMap="CIMGimageResult" javaType="com.echoed.chamber.domain.Image" />
        </constructor>
    </resultMap>

    <resultMap id="CIMGimageResult" type="com.echoed.chamber.domain.Image">
        <constructor>
            <idArg column="CIMGimageId" javaType="String" />
            <arg column="CIMGimageUpdatedOn" javaType="Date" />
            <arg column="CIMGimageCreatedOn" javaType="Date" />
            <arg column="CIMGimageUrl" javaType="String" />
            <arg column="CIMGimageOriginalUrl" javaType="String" />
            <arg column="CIMGimageOriginalWidth" javaType="_int" />
            <arg column="CIMGimageOriginalHeight" javaType="_int" />
            <arg column="CIMGimageSizedUrl" javaType="String" />
            <arg column="CIMGimageSizedWidth" javaType="_int" />
            <arg column="CIMGimageSizedHeight" javaType="_int" />
            <arg column="CIMGimageExhibitUrl" javaType="String" />
            <arg column="CIMGimageExhibitWidth" javaType="_int" />
            <arg column="CIMGimageExhibitHeight" javaType="_int" />
            <arg column="CIMGimageStoryUrl" javaType="String" />
            <arg column="CIMGimageStoryWidth" javaType="_int" />
            <arg column="CIMGimageStoryHeight" javaType="_int" />
            <arg column="CIMGimageThumbnailUrl" javaType="String" />
            <arg column="CIMGimageThumbnailWidth" javaType="_int" />
            <arg column="CIMGimageThumbnailHeight" javaType="_int" />
            <arg column="CIMGimageProcessedOn" javaType="Date" />
            <arg column="CIMGimageProcessedStatus" javaType="String" />
            <arg column="CIMGimageRetries" javaType="_int" />
        </constructor>
    </resultMap>


    <sql id="chapterImageColumns">
        CI.id as chapterImageId,
        CI.updatedOn as chapterImageUpdatedOn,
        CI.createdOn as chapterImageCreatedOn,
        CI.storyId as chapterImageStoryId,
        CI.echoedUserId as chapterImageEchoedUserId,
        CI.partnerId as chapterImagePartnerId,
        CI.partnerHandle as chapterImagePartnerHandle,
        CI.partnerSettingsId as chapterImagePartnerSettingsId,
        CI.echoId as chapterImageEchoId,
        CI.chapterId as chapterImageChapterId,
        <include refid="com.echoed.chamber.dao.ChapterImageDao.CIMGColumns" />
    </sql>

    <sql id="CIMGColumns">
        CIMG.id as CIMGimageId,
        CIMG.updatedOn as CIMGimageUpdatedOn,
        CIMG.createdOn as CIMGimageCreatedOn,
        CIMG.url as CIMGimageUrl,
        CIMG.originalUrl as CIMGimageOriginalUrl,
        CIMG.originalWidth as CIMGimageOriginalWidth,
        CIMG.originalHeight as CIMGimageOriginalHeight,
        CIMG.sizedUrl as CIMGimageSizedUrl,
        CIMG.sizedWidth as CIMGimageSizedWidth,
        CIMG.sizedHeight as CIMGimageSizedHeight,
        CIMG.exhibitUrl as CIMGimageExhibitUrl,
        CIMG.exhibitWidth as CIMGimageExhibitWidth,
        CIMG.exhibitHeight as CIMGimageExhibitHeight,
        CIMG.storyUrl as CIMGimageStoryUrl,
        CIMG.storyWidth as CIMGimageStoryWidth,
        CIMG.storyHeight as CIMGimageStoryHeight,
        CIMG.thumbnailUrl as CIMGimageThumbnailUrl,
        CIMG.thumbnailWidth as CIMGimageThumbnailWidth,
        CIMG.thumbnailHeight as CIMGimageThumbnailHeight,
        CIMG.processedOn as CIMGimageProcessedOn,
        CIMG.processedStatus as CIMGimageProcessedStatus,
        CIMG.retries as CIMGimageRetries
    </sql>

    <select id="findByChapterId" resultMap="chapterImageResult">
        select <include refid="chapterImageColumns" />
        from ChapterImage CI
        join Image CIMG on CI.imageId = CIMG.id
        where CI.chapterId = #{chapterId}
    </select>

    <delete id="deleteById">
        delete from ChapterImage where id = #{id}
    </delete>

    <delete id="deleteByChapterId">
        delete from ChapterImage where chapterId = #{chapterId}
    </delete>

    <insert id="insert" parameterType="com.echoed.chamber.domain.ChapterImage">
        insert into ChapterImage(
            id,
            updatedOn,
            createdOn,
            storyId,
            echoedUserId,
            partnerId,
            partnerHandle,
            partnerSettingsId,
            echoId,
            chapterId,
            imageId
        ) values (
            #{id},
            #{createdOn},
            #{updatedOn},
            #{storyId},
            #{echoedUserId},
            #{partnerId},
            #{partnerHandle},
            #{partnerSettingsId},
            #{echoId},
            #{chapterId},
            #{image.id})
    </insert>


</mapper>

