<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.echoed.chamber.dao.views.ClosetDao">
    <resultMap id="closetResult" type="com.echoed.chamber.domain.views.Closet">
        <constructor>
            <idArg column="echoedUserId" javaType="String" />
            <arg javaType="com.echoed.chamber.domain.EchoedUser" resultMap="echoedUserResult" />
        </constructor>
        <collection property="echoes" ofType="com.echoed.chamber.domain.Echo" javaType="ArrayList" resultMap="echoResult" />
    </resultMap>

    <resultMap id="echoedUserResult" type="com.echoed.chamber.domain.EchoedUser">
        <constructor>
            <idArg column="echoedUserId" javaType="String" />
			<arg column="echoedUserEmail" javaType="String" />
            <arg column="echoedUserFirstName" javaType="String" />
			<arg column="echoedUserLastName" javaType="String" />
        </constructor>
    </resultMap>

    <resultMap id="echoResult" type="com.echoed.chamber.domain.Echo">
        <constructor>
            <idArg column="echoId" javaType="String" />
            <arg column="echoBoughtOn" javaType="Date" />
            <arg column="echoPrice" javaType="String" />
            <arg column="echoImageUrl" javaType="String" />
        </constructor>
    </resultMap>

    <select id="findByEchoedUserId" resultMap="closetResult">
    	select
                EU.id as echoedUserId,
                EU.email as echoedUserEmail,
                EU.firstName as echoedUserFirstName,
                EU.lastName as echoedUserLastName,
                E.id as echoId,
                E.boughtOn as echoBoughtOn,
                E.imageUrl as echoImageUrl,
                E.price as echoPrice
        from EchoedUser EU
        left outer join Echo E on EU.id = E.echoedUserId
        where EU.id = #{id}
    </select>


</mapper>
