<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.echoed.chamber.dao.EchoedFriendDao">

    <cache-ref namespace="com.echoed.chamber.dao.cache.Default" />

    <resultMap id="echoedFriendResult" type="com.echoed.chamber.domain.EchoedFriend">
        <constructor>
            <idArg column="id" javaType="String" />
            <arg column="updatedOn" javaType="Date" />
			<arg column="createdOn" javaType="Date" />
			<arg column="fromEchoedUserId" javaType="String" />
			<arg column="toEchoedUserId" javaType="String" />
            <arg column="name" javaType="String" />
            <arg column="screenName" javaType="String" />
            <arg column="facebookUserId" javaType="String" />
            <arg column="facebookId" javaType="String" />
			<arg column="twitterUserId" javaType="String" />
			<arg column="twitterId" javaType="String" />
        </constructor>
    </resultMap>

    <select id="findFriendByEchoedUserId" resultMap="echoedFriendResult">
        select * from EchoedFriend
        where
            fromEchoedUserId = #{echoedUserId}
            AND
            toEchoedUserId = #{echoedFriendId}
    </select>

    <select id="findByEchoedUserId" resultMap="echoedFriendResult">
        select * from EchoedFriend where fromEchoedUserId = #{echoedUserId} order by name
    </select>

    <insert id="insertOrUpdate" parameterType="com.echoed.chamber.domain.EchoedFriend">
    	insert into EchoedFriend(
    	        id,
                createdOn,
                fromEchoedUserId,
                toEchoedUserId,
    			name,
                screenName,
                facebookUserId,
                facebookId,
                twitterUserId,
                twitterId)
    		values (
                #{id},
                #{createdOn},
                #{fromEchoedUserId},
                #{toEchoedUserId},
    			#{name},
    			#{screenName},
                #{facebookUserId},
                #{facebookId},
    			#{twitterUserId},
    			#{twitterId})
    	    on duplicate key update
    	        name = #{name},
    	        screenName = #{screenName},
    	        facebookUserId = #{facebookUserId},
    	        facebookId = #{facebookId},
    	        twitterUserId = #{twitterUserId},
    	        twitterId = #{twitterId}
    </insert>

    <delete id="deleteByEchoedUserId">
        delete from EchoedFriend where fromEchoedUserId = #{echoedUserId}
    </delete>

</mapper>
