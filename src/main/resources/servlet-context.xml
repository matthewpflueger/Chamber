<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
	    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	    xmlns:context="http://www.springframework.org/schema/context"
	    xmlns:util="http://www.springframework.org/schema/util"
        xmlns:mvc="http://www.springframework.org/schema/mvc"
	    xsi:schemaLocation="
	        http://www.springframework.org/schema/beans
	        http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
	        http://www.springframework.org/schema/context
	        http://www.springframework.org/schema/context/spring-context-3.2.xsd
            http://www.springframework.org/schema/mvc
            http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd
            http://www.springframework.org/schema/util
            http://www.springframework.org/schema/util/spring-util-3.2.xsd"
	    default-init-method="init"
	    default-destroy-method="destroy">


    <import resource="classpath:chamber-properties.xml" />

    <bean id="multipartResolver" class="org.springframework.web.multipart.support.StandardServletMultipartResolver" />

    <bean id="localeResolver" class="org.springframework.web.servlet.i18n.CookieLocaleResolver">
        <property name="defaultLocale" value="en"/>
    </bean>

    <bean id="cookieManager" class="com.echoed.chamber.controllers.CookieManager" />

    <bean id="handlerMapping" class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping">
        <property name="interceptors">
            <util:list>
                <bean class="com.echoed.chamber.interceptors.ResponseTimeInterceptor" />
                <bean class="com.echoed.chamber.interceptors.BrowserIdInterceptor">
                    <property name="cookieManager" ref="cookieManager" />
                </bean>
                <bean class="com.echoed.chamber.interceptors.AccessControlInterceptor">
                    <property name="domain" value="${domain}" />
                </bean>
                <bean class="com.echoed.chamber.interceptors.AuthorizationControlInterceptor">
                    <property name="cookieManager" ref="cookieManager" />
                    <property name="httpsUrl" value="${https.urls.site}" />
                </bean>
                <bean class="com.echoed.chamber.interceptors.GlobalsInterceptor">
                    <property name="globalsManager" ref="globalsManager" />
                </bean>
                <bean class="com.echoed.chamber.interceptors.ErrorsInterceptor">
                    <property name="messageSource" ref="messageSource" />
                </bean>
            </util:list>
        </property>
    </bean>

    <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter">
        <property name="messageConverters">
            <list>
                <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
                    <property name="objectMapper">
                        <bean class="com.echoed.util.ScalaObjectMapper" />
                    </property>
                </bean>
                <bean class = "org.springframework.http.converter.StringHttpMessageConverter">
                    <property name="writeAcceptCharset" value="false" />
                </bean>
            </list>
        </property>
        <property name="asyncRequestTimeout" value="30000" />
        <property name="asyncTaskExecutor" ref="executor" />
    </bean>

    <bean id="mustacheViewResolver" class="com.echoed.util.mustache.MustacheViewResolver">
        <property name="mustacheEngine" ref="mustacheEngine" />
        <property name="cache" value="${mustache.cache}" />
        <property name="prefix" value="${mustache.prefix}" />
        <property name="suffix" value="${mustache.suffix}" />
    </bean>




    <!-- Search package for annotated classes -->
    <context:component-scan base-package="com.echoed.chamber"/>


    <bean id="conversionService" class="org.springframework.format.support.FormattingConversionServiceFactoryBean" >
        <property name="registerDefaultFormatters" value="true" />
        <property name="formatters">
            <set>
                <bean class="org.springframework.format.number.NumberFormatAnnotationFormatterFactory" />
                <bean class="org.springframework.format.datetime.DateFormatter" />
            </set>
        </property>
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="storyController" class="com.echoed.chamber.controllers.StoryController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="encrypter" ref="encrypter" />
        <property name="siteUrl" value="${http.urls.site}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="imageUploadController" class="com.echoed.chamber.controllers.ImageUploadController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="blobStore" ref="blobStore" />
        <property name="imageService" ref="imageService" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="echoRegisterController" class="com.echoed.chamber.controllers.echo.EchoRegisterController">
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="partnerServiceManager" ref="partnerServiceManager" />
        <property name="cookieManager" ref="cookieManager" />



        <property name="errorView" value="error" />

        <property name="globalValidator" ref="validator" />
        <property name="formValidator" >
            <bean class="com.echoed.chamber.controllers.echo.EchoRegisterFormValidator" />
        </property>
        <property name="conversionService" ref="conversionService" />

        <property name="echoCloseViewUrl" value="redirect:${echoCloseUrl}"/>
        <property name="echoEchoedViewUrl" value="redirect:${echoEchoedUrl}"/>
        <property name="echoRegisterView" value="echo_register" />

    </bean>


    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="echoController" class="com.echoed.chamber.controllers.EchoController">
        <property name="actorSystem" ref="actorSystem" />
        <property name="echoService" ref="echoService" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="partnerServiceManager" ref="partnerServiceManager" />
        <property name="cookieManager" ref="cookieManager" />

        <property name="echoJsView" value="echo.js" />
        <property name="echoJsErrorView" value="echo_error.js" />
        <property name="echoJsNotActiveView" value="echo.js.inactive" />
        <property name="echoLoginView" value="echo_login" />
        <property name="echoCouponView" value="echo_coupon" />
        <property name="echoLoginNotNeededView" value="redirect:${echoConfirmUrl}" />
        <property name="echoRegisterUrl" value = "redirect:${echoRegisterUrl}" />
        <property name="echoEchoedUrl" value = "redirect:${echoEchoedUrl}" />

        <property name="echoConfirmView" value="echo_confirm" />
        <property name="echoFinishView" value="echo_finish" />
        <property name="echoIframe" value="echo_iframe" />
        <property name="echoAuthComplete" value="echo_auth_complete" />


        <property name="echoRedirectView" value="echo_redirect" />

        <property name="networkControllers">
            <map>
                <entry key="facebook" value-ref="facebookController" />
                <entry key="twitter" value-ref="twitterController" />
            </map>
        </property>

        <property name="productGraphUrl" value="${https.urls.site}/graph/product/" />
        <property name="buttonView" value="redirect:${buttonViewUrl}" />
        <property name="loginView" value="popuplogin" />
        <property name="confirmView" value="confirm" />
        <property name="echoItView" value="echoIt" />
        <property name="errorView" value="error" />
        <property name="facebookAddRedirectUrl" value="${https.urls.site}/facebook/add" />
        <property name="facebookLoginRedirectUrl" value="${https.urls.site}/facebook/login" />
        <property name="logoutUrl" value="${https.urls.site}/logout" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="facebookController" class="com.echoed.chamber.controllers.FacebookController">
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="facebookServiceLocator" ref="facebookServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
        <property name="facebookCanvasApp" value="${facebook.canvasApp}" />
        <property name="postLoginView" value="redirect:${https.urls.site}" />
        <property name="postAddView" value="redirect:${https.urls.site}" />
        <property name="facebookLoginErrorView" value="error" />
        <property name="facebookClientId" value="${facebook.clientId}" />
        <property name="facebookClientSecret" value="${facebook.clientSecret}" />
        <property name="siteUrl" value="${https.urls.site}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="twitterController" class="com.echoed.chamber.controllers.TwitterController">
        <property name="echoService" ref="echoService" />
        <property name="twitterServiceLocator" ref="twitterServiceLocator" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
        <property name="errorView" value="error" />
        <property name="postAddView" value="redirect:${https.urls.site}/" />
        <property name="postLoginView" value="redirect:${https.urls.site}/" />
        <property name="siteUrl" value="${https.urls.site}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="logoutController" class="com.echoed.chamber.controllers.LogoutController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="adminUserServiceLocator" ref="adminUserServiceLocator" />
        <property name="sqlSessionFactory" ref="sqlSessionFactory" />
        <property name="postLogoutView" value="redirect:${http.urls.site}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="exhibitController" class="com.echoed.chamber.controllers.ExhibitController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="eventService" ref="eventService" />
        <property name="closetView" value="user" />
        <property name="closetViewFacebook"  value="user.fb" />
        <property name="indexView" value="index" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="userController" class="com.echoed.chamber.controllers.api.UserController">
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="feedService" ref="feedService" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="partnerController" class="com.echoed.chamber.controllers.api.PartnerController">
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="loginController" class="com.echoed.chamber.controllers.partner.LoginController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="partnerLoginErrorView" value="login" />
        <property name="partnerLoginView" value="redirect:${dashboardUrl}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="activateController" class="com.echoed.chamber.controllers.partner.ActivateController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="activateView" value="partner_activate" />
        <property name="postActivateView" value="redirect:${dashboardUrl}" />
        <property name="globalValidator" ref="validator" />
        <property name="encrypter" ref="encrypter" />
        <property name="formValidator">
            <bean class="com.echoed.chamber.controllers.partner.ActivateFormValidator" />
        </property>
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="registerController" class="com.echoed.chamber.controllers.partner.RegisterController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerServiceManager" ref="partnerServiceManager" />
        <property name="registerView" value="partner_register" />
        <property name="postRegisterView" value="redirect:partner_register" />
        <property name="globalValidator" ref="validator" />
        <property name="formValidator" >
            <bean class="com.echoed.chamber.controllers.partner.RegisterFormValidator" />
        </property>
        <property name="conversionService" ref="conversionService" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="adminLoginController" class="com.echoed.chamber.controllers.AdminLoginController">
        <property name="adminUserServiceLocator"  ref="adminUserServiceLocator"/>
        <property name="adminLoginView" value="admin.login"/>
        <property name="adminDashboardView"  value="redirect:${adminDashboardUrl}"/>
        <property name="adminDashboardErrorView" value="admin.login"/>
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="adminDashboardController" class="com.echoed.chamber.controllers.AdminDashboardController">
        <property name="adminUserServiceLocator"  ref="adminUserServiceLocator"/>

        <property name="adminDashboardView" value="admin.dashboard" />
        <property name="adminDashboardErrorView" value="admin.login"/>
        <property name="cookieManager" ref="cookieManager"/>
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="dashboardController" class="com.echoed.chamber.controllers.partner.DashboardController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="partnerDashboardView" value="partner" />
        <property name="partnerDashboardErrorView" value="login" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="integrationController" class="com.echoed.chamber.controllers.partner.IntegrationController">
        <property name="integrationView" value="partner_integration" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="adminController" class="com.echoed.chamber.controllers.api.AdminController">
        <property name="adminUserServiceLocator" ref="adminUserServiceLocator"/>
        <property name="cookieManager" ref="cookieManager"/>
        <property name="globalValidator" ref="validator" />
        <property name="formValidator" >
            <bean class="com.echoed.chamber.controllers.api.admin.AdminUpdatePartnerSettingsFormValidator" />
        </property>
        <property name="conversionService" ref="conversionService" />

    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="shopifyController" class="com.echoed.chamber.controllers.partner.shopify.ShopifyController">
        <property name="shopifyPartnerServiceManager" ref="shopifyPartnerServiceManager" />
        <property name="shopifyIntegrationView" value="shopify_integration" />
        <property name="partnerLoginView" value="redirect:${dashboardUrl}" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>
    
    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="networkSolutionsController" class="com.echoed.chamber.controllers.partner.networksolutions.NetworkSolutionsController">
        <property name="networkSolutionsPartnerServiceManager" ref="networkSolutionsPartnerServiceManager" />
        <property name="registerView" value="networksolutions_register" />
        <property name="postAuthView" value="networksolutions_auth" />
        <property name="globalValidator" ref="validator" />
        <property name="conversionService" ref="conversionService" />
        <property name="successUrl" value="${http.urls.site}/networksolutions/auth" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="bigCommerceController" class="com.echoed.chamber.controllers.partner.bigcommerce.BigCommerceController">
        <property name="bigCommercePartnerServiceManager" ref="bigCommercePartnerServiceManager" />
        <property name="registerView" value="bigcommerce_register" />
        <property name="postRegisterView" value="bigcommerce_integration" />
        <property name="globalValidator" ref="validator" />
        <property name="conversionService" ref="conversionService" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="magentoGoController" class="com.echoed.chamber.controllers.partner.magentogo.MagentoGoController">
        <property name="magentoGoPartnerServiceManager" ref="magentoGoPartnerServiceManager" />
        <property name="registerView" value="magentogo_register" />
        <property name="postRegisterView" value="magentogo_integration" />
        <property name="globalValidator" ref="validator" />
        <property name="conversionService" ref="conversionService" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="publicController" class="com.echoed.chamber.controllers.api.PublicController">
        <property name="feedService" ref="feedService" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="sitemapController" class="com.echoed.chamber.controllers.SitemapController">
        <property name="feedService" ref="feedService" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="staticController" class="com.echoed.chamber.controllers.StaticController">
        <property name="businessView"  value="public_business" />
        <property name="contactUsView"  value="public_contactus" />
        <property name="whatIsEchoedView" value="public_whatisechoed" />
        <property name="privacyView" value="public_privacy" />
        <property name="termsView" value="public_terms" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="facebookGraphController" class="com.echoed.chamber.controllers.FacebookGraphController">
        <property name="echoService" ref="echoService"/>
        <property name="facebookAppNameSpace" value="${facebook.appNameSpace}" />
        <property name="facebookClientId" value="${facebook.clientId}" />
        <property name="errorView" value="error" />
        <property name="facebookGraphProductView" value="facebook_graph_product" />
    </bean>

    <!-- suppress DuplicatedBeanNamesInspection -->
    <bean id="widgetController" class="com.echoed.chamber.controllers.WidgetController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerServiceManager" ref="partnerServiceManager"/>
        <property name="widgetJsView" value="widget.js"/>
    </bean>

    <!-- Allows for mapping the DispatcherServlet to "/" by forwarding static resource requests to the container's default Servlet -->
    <mvc:default-servlet-handler default-servlet-name="default"/>

</beans>
