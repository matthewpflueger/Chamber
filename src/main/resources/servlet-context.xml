<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
	    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	    xmlns:p="http://www.springframework.org/schema/p"
	    xmlns:context="http://www.springframework.org/schema/context"
	    xmlns:util="http://www.springframework.org/schema/util"
        xmlns:mvc="http://www.springframework.org/schema/mvc"
	    xsi:schemaLocation="
	        http://www.springframework.org/schema/beans
	        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
	        http://www.springframework.org/schema/context
	        http://www.springframework.org/schema/context/spring-context-3.0.xsd
            http://www.springframework.org/schema/mvc
            http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd
            http://www.springframework.org/schema/util
            http://www.springframework.org/schema/util/spring-util-3.0.xsd"
	    default-init-method="init"
	    default-destroy-method="destroy">


    <import resource="classpath:chamber-properties.xml" />


    <bean id="handlerMapping" class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping">
        <property name="interceptors">
            <util:list>
                <bean class="com.echoed.chamber.interceptors.ResponseTimeInterceptor" />
                <bean class="com.echoed.chamber.interceptors.AccessControlInterceptor">
                    <property name="domain" value="${domain}" />
                </bean>
                <bean class="com.echoed.chamber.interceptors.GlobalsInterceptor">
                    <property name="globalsManager" ref="globalsManager" />
                </bean>
                <bean class="com.echoed.chamber.interceptors.ErrorsInterceptor">
                    <property name="messageSource" ref="messageSource" />
                </bean>
            </util:list>
        </property>
    </bean>

    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
        <property name="messageConverters">
            <list>
                <bean class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter">
                    <property name="objectMapper">
                        <bean class="com.echoed.util.ScalaObjectMapper" />
                    </property>
                </bean>
                <bean class = "org.springframework.http.converter.StringHttpMessageConverter">
                    <property name="writeAcceptCharset" value="false" />
                </bean>
            </list>
        </property>
    </bean>


    <bean id="mustacheViewResolver" class="com.echoed.util.mustache.MustacheViewResolver">
        <property name="mustacheEngine" ref="mustacheEngine" />
        <property name="cache" value="${mustache.cache}" />
        <property name="prefix" value="${mustache.prefix}" />
        <property name="suffix" value="${mustache.suffix}" />
    </bean>

    <bean id="cookieManager" class="com.echoed.chamber.controllers.CookieManager" />


    <!-- Search package for annotated classes -->
    <context:component-scan base-package="com.echoed.chamber"/>


    <bean id="conversionService" class="org.springframework.format.support.FormattingConversionServiceFactoryBean" >
        <property name="registerDefaultFormatters" value="true" />
        <property name="formatters">
            <set>
                <bean class="org.springframework.format.number.NumberFormatAnnotationFormatterFactory" />
                <bean class="org.springframework.format.datetime.DateFormatter" />
            </set>
        </property>
    </bean>


    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="echoController" class="com.echoed.chamber.controllers.EchoController">
        <property name="echoService" ref="echoService" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="buttonView" value="redirect:${buttonViewUrl}" />
        <property name="loginView" value="popuplogin" />
        <property name="confirmView" value="confirm" />
        <property name="echoItView" value="echoIt" />
        <property name="errorView" value="error" />
        <property name="cookieManager" ref="cookieManager" />
        <property name="facebookAddRedirectUrl" value="${http.urls.site}/facebook/add" />
        <property name="facebookLoginRedirectUrl" value="${http.urls.site}/facebook/login" />
        <property name="logoutUrl" value="${http.urls.site}/logout" />

    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="facebookController" class="com.echoed.chamber.controllers.FacebookController">
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="facebookServiceLocator" ref="facebookServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
        <property name="facebookCanvasApp" value="${facebook.canvasApp}" />
        <property name="postLoginView" value="redirect:${http.urls.site}" />
        <property name="postAddView" value="redirect:${http.urls.site}" />
        <property name="facebookLoginErrorView" value="redirect:${facebookLoginErrorViewUrl}" />
        <property name="facebookClientId" value="${facebook.clientId}" />
        <property name="facebookClientSecret" value="${facebook.clientSecret}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="twitterController" class="com.echoed.chamber.controllers.TwitterController">
        <property name="echoService" ref="echoService" />
        <property name="twitterServiceLocator" ref="twitterServiceLocator" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
        <property name="errorView" value="error" />
        <property name="postAddView" value="redirect:${http.urls.site}/" />
        <property name="postLoginView" value="redirect:${http.urls.site}/" />
        <property name="siteUrl" value="${http.urls.site}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="logoutController" class="com.echoed.chamber.controllers.LogoutController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="sqlSessionFactory" ref="sqlSessionFactory" />
        <property name="postLogoutView" value="redirect:${http.urls.site}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="exhibitController" class="com.echoed.chamber.controllers.ExhibitController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="closetView" value="user" />
        <property name="closetViewFacebook"  value="user.fb" />
        <property name="indexView" value="index" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="userController" class="com.echoed.chamber.controllers.api.UserController">
        <property name="echoedUserServiceLocator" ref="echoedUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="partnerController" class="com.echoed.chamber.controllers.api.PartnerController">
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="partnerLoginController" class="com.echoed.chamber.controllers.PartnerLoginController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="partnerLoginErrorView" value="login" />
        <property name="partnerLoginView" value="redirect:${dashboardUrl}" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="activateController" class="com.echoed.chamber.controllers.partner.ActivateController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="activateView" value="partner_activate" />
        <property name="postActivateView" value="redirect:${integrationUrl}" />
        <property name="globalValidator" ref="validator" />
        <property name="encrypter" ref="encrypter" />
        <property name="formValidator">
            <bean class="com.echoed.chamber.controllers.partner.ActivateFormValidator" />
        </property>
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="registerController" class="com.echoed.chamber.controllers.partner.RegisterController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerService" ref="partnerService" />
        <property name="registerView" value="partner_register" />
        <property name="postRegisterView" value="redirect:partner_register" />
        <property name="globalValidator" ref="validator" />
        <property name="formValidator" >
            <bean class="com.echoed.chamber.controllers.partner.RegisterFormValidator" />
        </property>
        <property name="conversionService" ref="conversionService" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="adminLoginController" class="com.echoed.chamber.controllers.AdminLoginController">
        <property name="adminUserServiceLocator"  ref="adminUserServiceLocator"/>
        <property name="adminLoginView" value="admin.login"/>
        <property name="adminDashboardView"  value="redirect:${adminDashboardUrl}"/>
        <property name="adminDashboardErrorView" value="admin.login"/>
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="adminDashboardController" class="com.echoed.chamber.controllers.AdminDashboardController">
        <property name="adminUserServiceLocator"  ref="adminUserServiceLocator"/>

        <property name="adminDashboardView" value="admin.dashboard" />
        <property name="adminDashboardErrorView" value="admin.login"/>
        <property name="cookieManager" ref="cookieManager"/>
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="partnerDashboardController" class="com.echoed.chamber.controllers.PartnerDashboardController">
        <property name="cookieManager" ref="cookieManager" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="partnerDashboardView" value="partner" />
        <property name="partnerDashboardErrorView" value="login" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="integrationController" class="com.echoed.chamber.controllers.partner.IntegrationController">
        <property name="integrationView" value="partner_integration" />
        <property name="partnerUserServiceLocator" ref="partnerUserServiceLocator" />
        <property name="cookieManager" ref="cookieManager" />
    </bean>

    <!--suppress DuplicatedBeanNamesInspection -->
    <bean id="adminController" class="com.echoed.chamber.controllers.api.AdminController">
        <property name="adminUserServiceLocator" ref="adminUserServiceLocator"/>
        <property name="cookieManager" ref="cookieManager"/>
    </bean>


    <!-- Allows for mapping the DispatcherServlet to "/" by forwarding static resource requests to the container's default Servlet -->
    <mvc:default-servlet-handler default-servlet-name="default"/>

</beans>
